<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <title>Catch The Thief</title>
    <meta name="viewport" content="width=device-width, user-scalable=no, height=device-height, initial-scale=1.0">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            background-color: black;
            touch-action: none;
            text-align: center;
        }

        #unity-container {
            position: relative;
            width: 100%;
            height: 100%;
            background-color: black;
        }

        #unity-canvas {
            display: block;
            margin: 0 auto;
            background-color: black;
        }

        #unity-canvas:focus {
            outline: none;
        }

        /* Hide Unity's default loading bar and footer */
        #unity-loading-bar, #unity-footer {
            display: none;
        }

        /* Loading Screen Styles */
        #status {
            position: absolute;
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            visibility: visible;
            z-index: 9999;
        }

        #status-progress {
            width: 366px;
            height: 7px;
            background-color: #38363A;
            border: 1px solid #444246;
            padding: 1px;
            box-shadow: 0 0 2px 1px #1B1C22;
            border-radius: 2px;
            visibility: visible;
        }

        @media only screen and (orientation:portrait) {
            #status-progress {
                width: 61.8%;
            }
        }

        #status-progress-inner {
            height: 100%;
            width: 0;
            box-sizing: border-box;
            transition: width 0.5s linear;
            background-color: #202020;
            border: 1px solid #222223;
            box-shadow: 0 0 1px 1px #27282E;
            border-radius: 3px;
        }

        #status-notice {
            margin: 0 100px;
            line-height: 1.3;
            visibility: visible;
            padding: 4px 6px;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="status">
        <div id="status-progress" style="display: none;" oncontextmenu="event.preventDefault();">
            <div id="status-progress-inner"></div>
        </div>
        <div id="status-notice" style="display: none;"></div>
    </div>

    <!-- Unity Container -->
    <div id="unity-container">
        <canvas id="unity-canvas" tabindex="1"></canvas>
    </div>
    <script>
      var buildUrl = "Build";
      var loaderUrl = buildUrl + "/CatchTheThiefWeb.loader.js";
      var config = {
        dataUrl: buildUrl + "/CatchTheThiefWeb.data",
        frameworkUrl: buildUrl + "/CatchTheThiefWeb.framework.js",
        codeUrl: buildUrl + "/CatchTheThiefWeb.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "DefaultCompany",
        productName: "Catch The Thief",
        productVersion: "1.0",
      };

      // Prevent context menu on right-click
      document.addEventListener('contextmenu', event => event.preventDefault());

      let canvas = document.getElementById("unity-canvas");
      let container = document.getElementById("unity-container");
      let unityInstance = null;

      // Loading Screen Elements
      const status = document.getElementById('status');
      const statusProgress = document.getElementById('status-progress');
      const statusProgressInner = document.getElementById('status-progress-inner');
      const statusNotice = document.getElementById('status-notice');

      function setStatusMode(mode) {
          switch (mode) {
              case 'progress':
                  statusProgress.style.display = 'block';
                  break;
              case 'notice':
                  statusNotice.style.display = 'block';
                  break;
              case 'hidden':
                  status.style.display = 'none';
                  break;
              default:
                  throw new Error('Invalid status mode');
          }
      }

      function resizeCanvas() {
          const aspectRatio = 9 / 16;
          let availableWidth = window.innerWidth;
          let availableHeight = window.innerHeight;

          // Force the height to match the window's height and calculate width to maintain aspect ratio
          let height = availableHeight;
          let width = height * aspectRatio;

          // Adjust for pixel ratio
          let pixelRatio = window.devicePixelRatio || 1;
          canvas.width = Math.floor(width * pixelRatio);
          canvas.height = Math.floor(height * pixelRatio);

          // Set CSS size in normal pixels
          canvas.style.width = width + 'px';
          canvas.style.height = height + 'px';

          // Update Unity with the correct size
          if (unityInstance != null) {
              unityInstance.Module.setCanvasSize(canvas.width, canvas.height, true);
          }
      }

      // Fullscreen toggle with F11 key
      document.addEventListener("keydown", function(event) {
          if (event.key === "F11") {
              event.preventDefault();
              if (!document.fullscreenElement) {
                  container.requestFullscreen().catch(err => {
                      console.log(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                  });
              } else {
                  document.exitFullscreen();
              }
          }
      });

      // Resize canvas when entering or exiting fullscreen
      document.addEventListener('fullscreenchange', resizeCanvas);
      window.addEventListener('resize', resizeCanvas);

      // Start the loading screen
      setStatusMode('progress');

      // Load Unity script
      var script = document.createElement("script");
      script.src = loaderUrl;

      script.onload = () => {
          createUnityInstance(canvas, config, (progress) => {
              statusProgressInner.style.width = `${(progress * 100)}%`;
              if (progress === 1) {
                  setStatusMode('hidden');
              }
          }).then((instance) => {
              unityInstance = instance;
              resizeCanvas();
          }).catch((message) => {
              console.error('Failed to load Unity:', message);
              statusNotice.innerText = message;
              setStatusMode('notice');
          });
      };

      script.onerror = () => {
          statusNotice.innerText = 'Failed to load Unity loader script.';
          setStatusMode('notice');
      };

      document.body.appendChild(script);
    </script>
  </body>
</html>
